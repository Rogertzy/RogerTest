<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFID Bookshelf</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .reader { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .active { background-color: #d4edda; }
        .inactive { background-color: #f8d7da; }
        .books { margin-left: 20px; }
    </style>
</head>
<body>
    <h1>Library RFID System</h1>
    <div id="readers"></div>

    <script>
        async function fetchReaders() {
            try {
                const response = await fetch('/api/readers');
                if (!response.ok) throw new Error('Failed to fetch readers');
                const readers = await response.json();
                displayReaders(readers);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('readers').innerHTML = '<p>Error loading readers</p>';
            }
        }

        function displayReaders(readers) {
            const container = document.getElementById('readers');
            container.innerHTML = '';
            readers.forEach(reader => {
                const div = document.createElement('div');
                div.className = `reader ${reader.status === 'active' ? 'active' : 'inactive'}`;
                div.innerHTML = `
                    <h3>${reader.name} (${reader.type === 'shelf' ? 'Bookshelf' : 'Return Box'})</h3>
                    <p>IP: ${reader.readerIp}</p>
                    <p>Status: ${reader.status}</p>
                    <div class="books" id="books-${reader.readerIp}"></div>
                `;
                container.appendChild(div);
                // Fetch books for this reader (placeholder for EPC data)
                fetchBooks(reader.readerIp, reader.type);
            });
        }

        async function fetchBooks(readerIp, type) {
            try {
                // Adjust endpoint based on your setup, e.g., /api/epcs?readerIp=...
                const response = await fetch(`/api/epcs?readerIp=${readerIp}`);
                if (!response.ok) throw new Error('Failed to fetch books');
                const books = await response.json();
                const bookContainer = document.getElementById(`books-${readerIp}`);
                bookContainer.innerHTML = books.length
                    ? books.map(book => `<p>${book.title} (EPC: ${book.epc})</p>`).join('')
                    : '<p>No books detected</p>';
            } catch (error) {
                console.error(`Error fetching books for ${readerIp}:`, error);
            }
        }

        // Poll for updates every 10 seconds
        fetchReaders();
        setInterval(fetchReaders, 10000);
    </script>
</body>
</html>